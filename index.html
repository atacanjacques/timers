<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Programmation Lave-linge & Lave-vaisselle</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">
<div class="container">
  <h2 class="mb-4">Programmation</h2>

  <!-- Onglets -->
  <ul class="nav nav-tabs mb-3" id="tabNav" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="lavage-tab" data-bs-toggle="tab" data-bs-target="#lavage" type="button" role="tab">Machine à laver</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="vaisselle-tab" data-bs-toggle="tab" data-bs-target="#vaisselle" type="button" role="tab">Lave-vaisselle</button>
    </li>
  </ul>

  <div class="tab-content">
    <!-- Machine à laver -->
    <div class="tab-pane fade show active" id="lavage" role="tabpanel">
      <div class="card p-3 shadow-sm mb-3">
        <div class="mb-3">
          <label for="startTime" class="form-label">Heure de début</label>
          <input type="time" class="form-control" id="startTime">
        </div>

        <div class="d-flex gap-2 mb-3">
          <button class="btn btn-primary" onclick="setTargetTime(8); calculateHours();">Finir à 8h</button>
          <button class="btn btn-secondary" onclick="setTargetTime(17); calculateHours();">Finir à 17h</button>
        </div>

        <div class="mb-3">
          <label for="targetTime" class="form-label">Heure cible (finir avant)</label>
          <input type="time" class="form-control" id="targetTime">
        </div>

        <button class="btn btn-success mb-3" onclick="calculateHours()">Calculer</button>
        <div id="resultLavage" class="alert alert-info" style="display:none;"></div>
      </div>
    </div>

    <!-- Lave-vaisselle -->
    <div class="tab-pane fade" id="vaisselle" role="tabpanel">
      <div class="card p-3 shadow-sm">
        <div class="mb-3">
          <label class="form-label">Options rapides :</label>
          <div class="d-flex gap-2">
            <button class="btn btn-primary" onclick="startAtHour(5)">Démarrer à 5h</button>
            <button class="btn btn-secondary" onclick="startAtHour(15)">Démarrer à 15h</button>
          </div>
        </div>

        <div class="mb-3">
          <label for="customStart" class="form-label">Heure de départ personnalisée</label>
          <input type="time" class="form-control" id="customStart" onchange="customStart()">
        </div>

        <div id="resultVaisselle" class="alert alert-info" style="display:none;"></div>
      </div>
    </div>
  </div>
</div>

<script>
/* ---------------- Machine à laver ---------------- */
document.getElementById('startTime').value =
  new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

function setTargetTime(hour) {
  const h = String(hour).padStart(2, '0');
  document.getElementById('targetTime').value = `${h}:00`;
}

function calculateHours() {
  const start = document.getElementById('startTime').value;
  const target = document.getElementById('targetTime').value;
  if (!start || !target) { alert("Veuillez entrer l'heure de départ et l'heure cible."); return; }

  const [sh, sm] = start.split(':').map(Number);
  const [th, tm] = target.split(':').map(Number);

  let startMin = sh * 60 + sm;
  let targetMin = th * 60 + tm;

  if (targetMin <= startMin) targetMin += 24*60;

  let hours = Math.floor((targetMin - startMin)/60);
  let finish = startMin + hours*60;

  if (finish >= targetMin) { hours -= 1; finish = startMin + hours*60; }

  const h = String(Math.floor(finish / 60) % 24).padStart(2,'0');
  const m = String(finish % 60).padStart(2,'0');

  const resultDiv = document.getElementById('resultLavage');
  resultDiv.style.display = "block";
  resultDiv.innerHTML = `<strong>Programmez ${hours}h</strong><br>Fin estimée : <strong>${h}:${m}${finish >= 24*60 ? " (le lendemain)" : ""}</strong>`;
}

/* ---------------- Lave-vaisselle ---------------- */
const cycleMinutes = 3*60 + 30; // 3h30
document.getElementById('customStart').value =
  new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});

function formatTime(totalMinutes) {
  const h = String(Math.floor(totalMinutes/60)%24).padStart(2,'0');
  const m = String(totalMinutes%60).padStart(2,'0');
  return `<strong>${h}:${m}</strong>`;
}

function showResult(text) { document.getElementById('resultVaisselle').style.display="block"; document.getElementById('resultVaisselle').innerHTML=text; }

function startAtHour(targetHour) {
  const now = new Date();
  let nowMinutes = now.getHours()*60 + now.getMinutes();
  let targetMinutes = targetHour*60;
  if (nowMinutes >= targetMinutes) targetMinutes += 24*60;

  let hoursToSet = Math.ceil((targetMinutes - nowMinutes)/60);
  let startTime = nowMinutes + hoursToSet*60;
  let finishTime = startTime + cycleMinutes;

  showResult(
    `Programmez ${hoursToSet}h sur la machine<br>` +
    `Démarrage prévu : ${formatTime(startTime)}<br>` +
    `Fin prévue : ${formatTime(finishTime)}`
  );
}

function customStart() {
  const val = document.getElementById('customStart').value;
  if (!val) return;
  const [h, m] = val.split(':').map(Number);
  const startMin = h*60 + m;
  const finishMin = startMin + cycleMinutes;

  showResult(`Démarrage à ${formatTime(startMin)}<br>Fin prévue : ${formatTime(finishMin)}`);
}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
